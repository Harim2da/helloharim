# 관리자의 의뢰 조회 기능

## 1. 단위 업무 흐름도

![](<../../../.gitbook/assets/의뢰조회 (1).PNG>)

관리자로 로그인 해, '의뢰 관리'를 선택하면 DB에 저장돼 있던 의뢰 정보를 불러와 view에서 보여주도록 만들려고 합니다.

사용자명, 청소 해결사명, 의뢰 일자로 검색이 가능하고, 이를 통해 원하는 의뢰를 조회할 수 있는 기능을 구현하려고 합니다.

## 2. 데이터베이스 모델링

![](<../../../.gitbook/assets/image (24).png>)

해당 기능을 구현하기 위해 필요한 엔터티는 크게 8개입니다.

* 회원 : 사용자 혹은 해결사 정보 조회
* 의뢰 정보 : 의뢰 상태, 일시 등 의뢰 관련 정보 일체
* 의뢰별 상품 : 의뢰 정보와 상품 정보의 다대다 관계를 해소하기 위한 엔터티
* 상품 정보 : 청소 상품의 정보 일체
* 결제 내역 : 가장 최신의 결제 정보
* 결제 상태 변경 이력 : 결제 이후로 변동 사항 정보
* 의뢰 상태 관리 : 한 의뢰 건에 대해서 의뢰 상태의 변경 이력 관리
* 의뢰 첨부파일 : 의뢰 상태가 '완료'가 되면 청소 해결사가 완료된 사진을 업로드하고, 이 사진을 저장하는 엔터티

## 3. 화면 정의서

조회해 온 데이터를 보여주는 화면을 설계했습니다.

![](<../../../.gitbook/assets/image (5).png>)

기획대로 검색 조건을 설정해, '검색' 버튼을 클릭하면 조회해 온 결과를 화면에 보여주는 방식입니다.&#x20;

## 4. 시퀀스 다이어그램

데이터 로직은 아래의 방식으로 진행됩니다.

![](<../../../.gitbook/assets/Untitled (2).png>)

검색어를 입력하면 parameter는 검색 조건이 되고, 만약 검색어 입력 없어 select해 온다면 parameter는 없습니다.

DB에서 select한 결과는 ArrayList형식의 값이 담겨져 return됩니다.

## 5. 구현 화면 및 코드

최종적으로 구현한 화면과 코드는 아래와 같습니다.



### 1) 구현 화면 및 view 코드

![](<../../../.gitbook/assets/image (27).png>)

![](<../../../.gitbook/assets/image (48) (1).png>)

1. 효율적인 코드 정리를 위해 jsp include 지시자 태그를 활용했습니다.  다른 jsp 파일에 nav bar를 작성하고 이를 불러오는 방식을 사용했습니다.
2. form 태그를 사용해 관리자가 입력한 검색어를 get 방식으로 전달해, 검색 기능 중, 주로 사용할 기능을 select 방식으로 선택할 수 있게 설정했습니다.



### 2) Model

![](<../../../.gitbook/assets/image (12) (1).png>)

1. view에서 입력한 검색어 및 검색 조건을 hashMap에 담아 전달했습니다.
2. DB에서 조회한 결과 값은 여러 개의 DTO를 포함하므로, ArrayList 자료형으로 return했습니다.



### 3) SQL

![](<../../../.gitbook/assets/image (29) (1).png>)

1. 같은 table을 공유하는 사용자 정보와 청소 해결사 정보는, 스칼라 서브쿼리를 통해 조회했습니다.
2. Mybatis 동적 SQL을 활용하여 검색 시, 효율적으로 쿼리문을 작성했습니다.
